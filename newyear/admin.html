<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>春节后台</title>
	<link href="http://cdn.bootcss.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<style>
		.container{
			position:absolute;
			left:10%;
			top:10%;
			right:15%;
			bottom:10%;
			z-index:9;
		}
		.container table{
			border:1px solid #CCC;
			margin-top:20px;
		}
		.listHiddenText{
			width:150px;
			height:20px;
			line-height:20px;
			border:none;
			background:none;
			outline:none;
			box-sizing:border-box;
			padding:0 5px;
		}
		.listHiddenText.oncheck{
			border:1px solid #CCC;
			background:#FFF;
			color:#000;
			border-radius:4px;
		}
	</style>
</head>
<body>
	
	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			<h4 class="modal-title" id="myModalLabel">添加客户</h4>
		  </div>
		  <div class="modal-body">
			<input type="text" class="form-control cus_name" placeholder="客户名称"><br/>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default cus_close" data-dismiss="modal">关闭</button>
			<button type="button" class="btn btn-primary cus_save">保存</button>
		  </div>
		</div>
	  </div>
	</div>
	
	<div class="container">
		<button type="button" class="btn btn-info cus_add" data-toggle="modal" data-target="#myModal">添加</button>
		<table class="table table-striped table-hover cus_List">
			<thead>
				<tr>
					<th>id</th>
					<th>客户名</th>
					<th>添加时间</th>
					<th>页面地址</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</div>
	
	<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js" language="javascript"></script>
	<script src="http://cdn.bootcss.com/bootstrap/3.3.1/js/bootstrap.min.js" language="javascript"></script>
	<Script>
		
		function addHtml(d){
			var dir = '';
			var i;
			var html = '';
			var href = '';
			for(i in d){
				href = dir + 'index.html?cus=' + d[i].id;
				html += '<tr>';
				html += '<td>'+d[i].id+'</td>';
				html += '<td><input type="text" class="listHiddenText" value="'+d[i].name+'" /></td>';
				html += '<td>'+d[i].time+'</td>';
				html += '<td><a href="'+href+'" target="_blank">'+href+'</a></td>';
				html += '<td><a href="javascript:;" data-id="'+d[i].id+'" class="cus_edit">修改</a>&nbsp;&nbsp;';
				html += '<a href="javascript:;" data-id="'+d[i].id+'" class="cus_del">删除</a></td>';
				html += '</tr>';
			}
			$(".cus_List tbody").html(html);
		}
		function setAjax(a,b,c,callback){
			$.ajax({
				type : a ? a : "GET",
				url  : b,
				success : "function" == typeof callback ? callback : function(){
					console.log("callback error");
				}
			});
		}
		function setFillList(){
			var tType = "GET",
				tUrl = "lib/query.php",
				tData = '',
				fileList = function(data){
					addHtml(data);
				};
			
			setAjax(tType,tUrl,tData,fileList);
		};
		function saveCustomer(){
			var name = $(".cus_name").val();
			var tType = "GET",
				tData = "",
				tUrl = "lib/add.php?add=1&name="+name,
				addDone = function(data){
					addHtml(data);
					$(".cus_name").val("");
					$(".cus_close").trigger("click");
				},
				emptyNotice = function(){
					alert("请先输入客户名称");
				};
			name ? setAjax(tType,tUrl,tData,addDone) : emptyNotice();
		};
		function delCustomer(){
			var self = $(this),
				slefBox = self.closest("tr"),
				slefId = self.attr("data-id");
			var tType = "GET",
				tData = "",
				tUrl = "lib/del.php?del="+slefId,
				delDone = function(d){
					slefBox.css("background","#ccc").fadeOut(500);
					setTimeout(function(){
						slefBox.remove();
					},600);
				}
			setAjax(tType,tUrl,tData,delDone);
		};
		function editCustomer(){
			var self = $(this),
				selfId = self.attr("data-id"),
				selfText = self.closest("tr").find(".listHiddenText").val();
			var tType = "GET",
				tData = "",
				tUrl = "lib/edit.php?id="+selfId+"&name="+selfText,
				editDone = function(d){
					alert("edit");
				};
			setAjax(tType,tUrl,tData,editDone);
		};
		function textCheck(e){
			var self = $(this);
			if(e.type == "click"){
				self.addClass("oncheck");
			}else if(e.type == "focusout"){
				self.removeClass("oncheck");
			}
		}
		$(function(){
			setFillList();
			$(document).on("keydown",function(event){
				var e = event || window.event || arguments.callee.caller.arguments[0];
				if(e && e.keyCode==13){
					$(".cus_save").trigger("click");
				}
				if(e && e.keyCode==9){
					$(".cus_add").trigger("click");
				}
			});
			$("body").on("click focusout", ".listHiddenText", textCheck);
			$("body").on("click", ".cus_save", saveCustomer);
			$("body").on("click", ".cus_edit", editCustomer);
			$("body").on("click", ".cus_del", delCustomer);
		})
	</script>
</body>
</html>